<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>추가 정보 입력</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .role-select-container {
            max-width: 600px;
            margin: 50px auto;
            text-align: center;
        }
        .form-container {
            max-width: 600px;
            margin: 30px auto;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        #shopForm {
            display: none;
        }
        #customerForm {
            display: none;
        }
    </style>
</head>
<body>

<!-- 공통 정보 입력 폼 추가 -->
<div class="form-container" id="commonForm">
    <h3 class="mb-4">기본 정보 입력</h3>
    <div class="form-group">
        <label for="nickname">닉네임</label>
        <input type="text" class="form-control" id="nickname" th:value="${user.nickname}" required>
        <small class="form-text text-muted">소셜 로그인에서 가져온 닉네임입니다. 수정 가능합니다.</small>
    </div>
</div>


<div class="role-select-container">
    <h2 class="mb-4">회원 유형을 선택해주세요</h2>
    <div class="btn-group" role="group">
        <input type="radio" class="btn-check" name="roleType" id="customer" autocomplete="off" value="customer">
        <label class="btn btn-outline-primary" for="customer">고객</label>

        <input type="radio" class="btn-check" name="roleType" id="groomer" autocomplete="off" value="groomer">
        <label class="btn btn-outline-primary" for="groomer">미용사</label>
    </div>
</div>

<!-- 고객 정보 입력 폼 -->
<div id="customerForm" class="form-container">
    <h3 class="mb-4">고객 정보 입력</h3>
    <form id="customerInfoForm">
        <div class="form-group">
            <label for="customerPhone">전화번호</label>
            <input type="tel" class="form-control" id="customerPhone" required>
        </div>
        <div class="form-group">
            <label for="shopSigungu">시/군/구</label>
            <input type="text" class="form-control" id="customerSigungu" placeholder="시/군/구를 직접 입력해주세요" required>
        </div>
        <div class="form-group">
            <label for="customerAddress">상세 주소</label>
            <input type="text" class="form-control" id="customerAddress" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">등록하기</button>
    </form>
</div>

<!-- 미용사 정보 입력 폼 -->
<div id="shopForm" class="form-container">
    <h3 class="mb-4">미용사 및 매장 정보 입력</h3>
    <form id="groomerInfoForm">
        <div class="form-group">
            <label for="groomerPhone">전화번호</label>
            <input type="tel" class="form-control" id="groomerPhone" required>
        </div>
        <div class="form-group">
            <label for="shopName">매장명</label>
            <input type="text" class="form-control" id="shopName" required>
        </div>
        <div class="form-group">
            <label for="description">매장 설명</label>
            <textarea class="form-control" id="description" rows="3" required></textarea>
        </div>
        <div class="form-group">
            <label for="shopSigungu">시/군/구</label>
            <select class="form-control" id="shopSigungu" required>
                <!-- 시군구 옵션들은 동적으로 로드 -->
            </select>
        </div>
        <div class="form-group">
            <label for="shopAddress">매장 주소</label>
            <input type="text" class="form-control" id="shopAddress" required>
        </div>
        <div class="form-group">
            <label for="businessTime">영업 시간</label>
            <input type="text" class="form-control" id="businessTime" placeholder="예: 10:00-19:00" required>
        </div>
        <div class="form-group">
            <label for="shopImage">매장 이미지</label>
            <input type="file" class="form-control" id="shopImage" accept="image/*">
        </div>
        <button type="submit" class="btn btn-primary w-100">등록하기</button>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.querySelectorAll('input[name="roleType"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
            const customerForm = document.getElementById('customerForm');
            const shopForm = document.getElementById('shopForm');

            if (e.target.value === 'customer') {
                customerForm.style.display = 'block';
                shopForm.style.display = 'none';
            } else {
                customerForm.style.display = 'none';
                shopForm.style.display = 'block';
            }
        });
    });

    // 고객 정보 제출
    document.getElementById('customerInfoForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
            const response = await fetch('/api/users/register/customer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    phone: document.getElementById('customerPhone').value,
                    sigunguId: document.getElementById('customerSigungu').value,
                    address: document.getElementById('customerAddress').value,
                    // latitude와 longitude는 주소 API 연동 필요
                })
            });
            if (response.ok) {
                alert('고객 등록이 완료되었습니다.');
                window.location.href = '/';
            }
        } catch (error) {
            console.error('Error:', error);
            alert('등록 중 오류가 발생했습니다.');
        }
    });

    // 미용사 정보 제출
    document.getElementById('groomerInfoForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData();

        const groomerData = {
            phone: document.getElementById('groomerPhone').value
        };

        const shopData = {
            shopName: document.getElementById('shopName').value,
            description: document.getElementById('description').value,
            sigunguId: document.getElementById('shopSigungu').value,
            address: document.getElementById('shopAddress').value,
            businessTime: document.getElementById('businessTime').value,
            // latitude와 longitude는 주소 API 연동 필요
        };

        try {
            const response = await fetch('/api/users/register/groomer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    groomerDTO: groomerData,
                    shopDTO: shopData
                })
            });
            if (response.ok) {
                alert('미용사 등록이 완료되었습니다.');
                window.location.href = '/';
            }
        } catch (error) {
            console.error('Error:', error);
            alert('등록 중 오류가 발생했습니다.');
        }
    });

    // 시군구 데이터 로드
    async function loadSigunguData() {
        try {
            const response = await fetch('/api/sigungu');
            const data = await response.json();
            const options = data.map(sigungu =>
                `<option value="${sigungu.id}">${sigungu.name}</option>`
            ).join('');

            document.getElementById('customerSigungu').innerHTML = options;
            document.getElementById('shopSigungu').innerHTML = options;
        } catch (error) {
            console.error('Error loading sigungu data:', error);
        }
    }

    loadSigunguData();
</script>
</body>
</html>